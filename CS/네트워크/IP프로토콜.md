## IP 프로토콜

인터넷 환경에서 네트워크 계층의 `데이터 전송 프로토콜`로 이용되는 IP(Internet Protocol)는 호스트 주소 표기, 패킷 분할에 관한 기능을 지원하지만, 단대단(end to end) 형식의 오류 제어나 흐름 제어 기능은 제공하지 않는다.

- 비연결 서비스를 제공한다.
- 패킷을 분할/병합하는 기능을 수행하기도 한다.
- 데이터 체크섬은 제공하지 않고, 헤더 체크섬만 제공한다.
- Best Effort 원칙에 따른 전송 기능을 제공한다.

[IP 헤더의 구조]

![image](https://github.com/H-sooyeon/TIL/assets/56586470/9060c500-35ab-4520-85f8-f620544e45bd)

상단의 숫자는 비트 수이다.

<br />

### DS/ECN

`차등 서비스` 개념이 도입되면서 Service Type 필드가 6비트의 `DS(Differentiated Service)필드`와 `2비트의 ECN(Explicit Congestion Notification) 필드`로 새로 정의되었다.

이는 인터넷에서 다양한 트래픽 요구 조건을 필요로 하는 서비스들에 대하여 서로 다른 수준의 QoS(Quality of Service)를 지원하기 위함이다.

DS를 사용하기 위해 사전에 서비스 제공자와 서비스 이용자 사이에 서비스 등급에 대한 합의가 이루어지며, 동일한 DS 값을 갖는 트래픽들은 동일한 서비스 등급으로 처리된다.

<br />

### 주소 관련 필드

![image](https://github.com/H-sooyeon/TIL/assets/56586470/e3dc4651-926b-4828-83a9-1e4bbae3912e)

- `network(네트워크)`
  네트워크 주소이다.
- `host(호스트)`
  네트워크 주소가 결정되면 하위의 호스트 주소를 의미하는 host 비트 값을 개별 네트워크의 관리자가 할당한다.

![image](https://github.com/H-sooyeon/TIL/assets/56586470/b7e89c56-0501-4887-a6e1-c6ab6df8664f)

- `Version Number(버전 번호)`
  IP 프로토콜의 버전 번호이다.
- `Header Length(헤더 길이)`
  IP 프로토콜의 헤더 길이를 32비트 워드 단위로 표시한다.
- `Packet Length(패킷 길이)`
  IP 헤더를 포함하여 패킷의 전체 길이를 나타낸다.
- `Time To Live(생존 시간)`
  송신 호스트가 패킷을 전송하기 전에 네트워크에서 생존할 수 있는 시간을 지정하고, 각 라우터에서는 패킷이 지나갈 때마다 필드 값을 감소시키면서 패킷을 중개한다.
  임의의 라우터에서 Time To Live 값이 0으로 감소하면 패킷은 자동으로 버려진다.
- `Transport(전송 프로토콜)`
  IP 프로토콜에 데이터 전송을 요구한 전송 계층의 프로토콜을 가리킨다.

![image](https://github.com/H-sooyeon/TIL/assets/56586470/5c7e4604-e6b8-4bb5-a46a-a3a201b4bee5)

- `Header Checksum(헤더 체크섬)`
  전송 과정에서 발생할 수 있는 헤더 오류를 검출하는 기능이다.
- `Options(옵션)`
  네트워크 관리나 보안처럼 특수 용도로 이용할 수 있다.
- `Padding(패딩)`
  IP 헤더의 크기는 16비트 워드의 크기가 4의 배수가 되도록 설계되어 있다. 필드의 전체 크기가 이 조건에 맞지 않으면 이 필드를 사용해 조정할 수 있다.

## 정적IP 주소와 동적 IP 주소

전자는 호스트에 직접 수작업으로 IP 주소를 부여하는 방식이다.

정적 IP 주소는 호스트의 수가 많아질 수록 관리가 곤란해질 수 있다. 의도치 않게 잘못된 IP 주소를 입력할 수도 있고, 중복된 주소를 입력할 수도 있다.

이럴 때 사용한 주소 할당 방식이 동적 할당이다.

정적 할당과는 달리 IP 주소를 직접 일일이 입력하지 않아도 호스트에 IP 주소가 동적으로 할당되는 방식이다.

동적 IP 주소는 사용되지 않을 경우 회수되고, 할당받을 때마다 다른 주소를 받을 수 있다.

IP 동적 할당에 사용되는 대표적인 프로토콜이 DHCP이다.

IP 주소를 할당받고자 하는 호스트와 해당 호스트에게 IP 주소를 제공하는 DHCP 서버간에 메시지를 주고받음으로써 이루어진다.

여기서 DHCP 서버의 역할은 일반적으로 라우터가 수행하지만, 특정 호스트에 DHCP 서버 기능을 추가할 수도 있다.

DHCP 서버는 호스트에게 할당 가능한 IP 주소 목록을 관리하다가, 호스트가 요청할 때 IP 주소를 할당한다.

IP 주소를 할당받는 과정에서 클라이언트와 DHCP 서버간에 주고받는 메시지의 종류는 크게 네 가지가 있다.

- DHCP Discover
- DHCP Offer
- DHCP Request
- DHCP ACK

1. DHCP Discover

   클라이언트는 DHCP Discover 메시지를 통해 DHCP 서버를 찾는다. 이는 브로드캐스트로 전송된다.
   이 시점에 클라이언트는 아직 IP 주소를 할당받지 못했으므로 송신지 IP 주소는 0.0.0.0으로 설정된다.

2. DHCP Offer
   DHCP 서버는 메시지를 받은 뒤 클라이언트에게 DHCP Offer 메시지를 보낸다. 클라이언트에게 할당해줄 IP 주소를 제안하는 메시지이다. 또한 서브넷 마스크, 임대 기간 등의 정보도 포함되어 있다.
3. DHCP Request
   DHCP Offer 메시지에 대한 응답이다. 이 또한 브로드캐스트로 전송된다.
   비유하자면, DHCP Offer 메시지 잘 받았는데, 이 IP 주소 써도 되지요? 라고 묻는 것과 같다.
4. DHCP ACK
   마지막으로 서버는 클라이언트에게 DHCP ACK 메시지를 보낸다.
   최종 승인과도 같은 메시지이며, DHCP ACK 메시지까지 받은 클라이언트는 이제 할당받은 IP 주소를 자신의 IP 주소로 설정한 뒤 임대 기간 동안 사용한다.
