## 불변성을 지켜야 하는 이유

개발자로서 유지보수가 가능하고 가독성이 좋은 코드를 작성해야 한다.

불변성을 지키지 않는다면 사용할 데이터가 어디서 어떻게 바뀌어가는지 흐름을 쫓아가기 어렵고, 이는 곧 예기치 못한 side effects나 버그로 이어지게 된다.

불변성을 지킨 코드는 불필요한 의심 없이 코드를 읽는 그대로 흐름을 따라가면서 이해할 수 있도록 돕는다.

따라서 불변성을 지키면서부 데이터를 변화시킨다면, 예상 가능하고 신뢰할 수 있는 코드가 될 수 있다.

불병성을 지킨다는 의미는 메모리 영역에서 값을 변경할 수 없게 한다는 의미이다.

리액트에서는 state 변화 감지 기준을 콜 스택의 주소값으로 잡으며 이를 얕은 비교라고 한다.

원시타입의 경우는 값을 재할당할 경우 새로운 메모리가 할당되어 콜 스택의 주소 값이 감지가 되지만, 참조 타입의 경우 참조타입의 값만 변경하면 실제로 콜 스택의 주소 값은 변경이 없어 state 감지가 되지 않아 리렌더링이 되지 않는다. 이것이 우리가 spread 연산자를 쓰고, Immer 라이브러리를 사용해 새로운 배열과 오브젝트를 만들어 변환하는 이유이다.

<br />

### 원시 타입의 불변성

![image](https://github.com/H-sooyeon/TIL/assets/56586470/96a2fb61-c4a0-41d4-8f38-146c2f8d63cb)


원시타입의 변수는 변수값을 변경하라는 명령을 받을 경우, 기존 콜스택의 값을 변경하지 않고 새로운 주소를 추가해 값을 저장하고 변수 b가 바라보게 한다. 이것을 불변성이라고 한다.

그리고 더 이상 참조되지 않는 데이터는 가비지 컬렉터에 의해 적절한 시점에서 메모리가 해제된다.

(메모리 영역의 값은 변경되지 않는다.)

### 참조 타입의 불변성

![image](https://github.com/H-sooyeon/TIL/assets/56586470/49d38487-b16d-4b52-bd1a-d3f036265d3c)


참조 타입에서는 콜스택의 값이 변경되지 않고, 메모리 힙에 있는 데이터가 변경이 되어 불변성이 유지가 되지 않는다. 여기서 참조 타입은 힙에 데이터가 저장되며 콜 스택에 해당 힙의 주소가 저장된다.
