## 스트리밍

스트리밍은 경로를 더 작은 “청크”로 나누고 준비가 되면 서버에서 클라이언트로 점진적으로 스트리밍할 수 있는 데이터 전송 기술이다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/8f34238a-246a-4ffd-8d8a-f3a45a9148ed/dea1a006-b452-406f-a8a0-fb4fbfb8ef30/Untitled.png)

스트리밍을 하면 느린 데이터 요청이 전체 페이지를 차단하는 것을 방지할 수 있다.
이를 통해 사용자는 UI가 사용자에게 표시되기 전에 모든 데이터가 로드될 떄까지 기다리지 않고 페이지의 일부를 보고 상호작용할 수 있다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/8f34238a-246a-4ffd-8d8a-f3a45a9148ed/33b1fa69-b1de-4485-b1e7-6949010caf76/Untitled.png)

Next.js에서 스트리밍을 구현하는 방법에는 두 가지가 있다.

1. 페이지 수준에서 `loading.tsx` 파일을 사용한다.
2. 특정 구성 요소의 경우 `<Suspense>` 를 사용한다.

### 스트리밍의 장점

청크가 병렬로 렌더링되어 페이지의 전체 로딩 시간이 단축된다.

## 경로 그룹 로드 스켈레톤 버그 수정

로딩 페이지는 해당 경로의 최상단에 있으면 하위 경로에도 로딩 시 해당 스켈레톤이 출력된다.

이는 `Route Groups` 를 사용하여 변경할 수 있다.

`/(overview)` 폴더 안에 `loading.tsx` 및 `page.tsx` 파일을 옮긴다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/8f34238a-246a-4ffd-8d8a-f3a45a9148ed/83d0c6d4-c38d-456d-a28b-3380404e2386/Untitled.png)

위와 같은 디렉토리 구조로 수정하면, `loading.tsx` 파일은 대시보드 개요 페이지에만 적용된다.

경로 그룸을 사용하면 URL 경로 구조에 영향을 주지 않고 파일을 논리적 그룹으로 구성할 수 있다.
괄호를 사용하여 새 폴더를 생성하면 () 이름이 URL 경로에 포함되지 않는다.

그래서 `/dashboard/(overview)/page.tsx` 가 된다.

## 부분 사전 렌더링

Next.js 14에는 일부 부분을 동적으로 유지하면서 정적 로딩 셸을 사용하여 경로를 렌더링할 수 있는 실험적인 기능인 부분 사전 렌더링이 포함되어 있다. 즉, 경로의 동적 부분을 분리할 수 있다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/8f34238a-246a-4ffd-8d8a-f3a45a9148ed/00d3a688-167a-49a4-8a94-36a0bfc71365/Untitled.png)

사용자가 경로를 방문할 때

- 정적 경로 셸이 제공되어 빠른 초기 로드를 보장한다.
- 셸에는 동적 콘텐츠가 비동기식으로 로드되는 구멍이 남는다.
- 비동기 컴포넌트는 병렬로 스트리밍되어 페이지의 전체 로드시간을 줄인다.

### 정리

애플리케이션에서 데이터 가져오기를 최적화하기 위해 몇 가지 작업을 수행할 수 있다.

1. 서버와 데이터베이스 간의 대기 시간을 줄이기 위해 애플리케이션 코드와 동일한 위치에 데이터베이스를 만든다.
2. React Server Components를 사용하여 서버에서 데이터를 가져온다. 이를 통해 서버에서 비용이 많이 드는 데이터 패치와 로직을 방지하고 클라이언트 측 JavaScript 번들을 줄이고, 데이터베이스의 비밀이 클라이언트에 노출되는 것을 방지할 수 있따.
3. SQL을 사용하여 필요한 데이터만 가져오므로 각 요청에 대해 전송되는 데이터의 양과 메모리 내 데이터를 변환하는 데 필요한 JavaScript의 양이 줄어든다.
4. JavaScript를 사용하여 데이터 가져오기를 병렬화하는 것이 합리적이다.
5. 느린 데이터 요청이 전체 페이지를 차단하는 것을 방지하고, 사용자가 모든 것이 로드될 때까지 기다리지 않고 UI와 상호작용을 시작할 수 있도록 스트리밍을 구현한다.
6. 데이터 가져오기를 필요한 구성 요소로 이동하여 부분 사전 렌더링을 준비할 때 경로의 어느 부분이 동적으로 이루어져야 하는지 분리한다.
